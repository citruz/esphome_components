external_components:
  - source: github://jplitza/esphome_components

logger:
  baud_rate: 0

uart:
  id: uart_bus
  rx_pin: GPIO3
  baud_rate: 9600
  data_bits: 7
  parity: ODD

obis:
  uart_id: uart_bus
  force_update:  # optional
    interval: 10
    payload: "\x2F\x3F\x21\x0D\x0A"

sensor:
  - platform: obis
    channel: "1-0:1.8.0*255"
    name: "Power Meter"
    unit_of_measurement: "kWh"
    device_class: energy
    state_class: total_increasing
    accuracy_decimals: 2
    icon: "mdi:speedometer"
    filters:
    - throttle: 30s

  - platform: obis
    channel: "1-0:21.7.255*255"
    name: "Phase 1 Power"
    unit_of_measurement: "W"
    device_class: power
    state_class: measurement
    accuracy_decimals: 0
    icon: "mdi:numeric-1-circle"
    filters:
    - sliding_window_moving_average:
        window_size: 5
        send_every: 5

  - platform: obis
    channel: "1-0:41.7.255*255"
    name: "Phase 2 Power"
    unit_of_measurement: "W"
    device_class: power
    state_class: measurement
    accuracy_decimals: 0
    icon: "mdi:numeric-2-circle"
    filters:
    - sliding_window_moving_average:
        window_size: 5
        send_every: 5

  - platform: obis
    channel: "1-0:61.7.255*255"
    name: "Phase 3 Power"
    unit_of_measurement: "W"
    device_class: power
    state_class: measurement
    accuracy_decimals: 0
    icon: "mdi:numeric-3-circle"
    filters:
    - sliding_window_moving_average:
        window_size: 5
        send_every: 5

  - platform: obis
    channel: "1-0:1.7.255*255"
    name: "Total Power"
    unit_of_measurement: "W"
    device_class: power
    state_class: measurement
    accuracy_decimals: 0
    icon: "mdi:flash"
    filters:
    - sliding_window_moving_average:
        window_size: 5
        send_every: 5

text_sensor:
  - platform: obis
    channel: "0-0:96.1.255*255"
    name: "Serial Number"
